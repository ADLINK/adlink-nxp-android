From 22b45fab34eb8b7b9d129fc760396bc9f9e949bc Mon Sep 17 00:00:00 2001
From: adlinkshiva <shivashankar.thiruchitrambalam@adlinktech.com>
Date: Tue, 16 Jul 2024 01:43:23 +0530
Subject: [PATCH] Remove_battery_icon

Signed-off-by: adlinkshiva <shivashankar.thiruchitrambalam@adlinktech.com>
---
 packages/SystemUI/res/values/dimens.xml                    | 4 ++--
 .../src/com/android/systemui/battery/BatteryMeterView.java | 7 +++++++
 2 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/packages/SystemUI/res/values/dimens.xml b/packages/SystemUI/res/values/dimens.xml
index b8fabbec6c2b..48d9bd2c0003 100644
--- a/packages/SystemUI/res/values/dimens.xml
+++ b/packages/SystemUI/res/values/dimens.xml
@@ -99,11 +99,11 @@
     <dimen name="status_bar_horizontal_padding">2.5dp</dimen>
 
     <!-- Height of the battery icon in the status bar. -->
-    <dimen name="status_bar_battery_icon_height">13.0dp</dimen>
+    <dimen name="status_bar_battery_icon_height">0dp</dimen>
 
     <!-- Width of the battery icon in the status bar. The battery drawable assumes a 12x20 canvas,
     so the width of the icon should be 13.0dp * (12.0 / 20.0) -->
-    <dimen name="status_bar_battery_icon_width">7.8dp</dimen>
+    <dimen name="status_bar_battery_icon_width">0dp</dimen>
 
     <!-- The font size for the clock in the status bar. -->
     <dimen name="status_bar_clock_size">14sp</dimen>
diff --git a/packages/SystemUI/src/com/android/systemui/battery/BatteryMeterView.java b/packages/SystemUI/src/com/android/systemui/battery/BatteryMeterView.java
index 6a10d4ab1e8b..4504fd7dc414 100644
--- a/packages/SystemUI/src/com/android/systemui/battery/BatteryMeterView.java
+++ b/packages/SystemUI/src/com/android/systemui/battery/BatteryMeterView.java
@@ -212,6 +212,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
      * Updates percent view by removing old one and reinflating if necessary
      */
     public void updatePercentView() {
+        mBatteryPercentView = null;
         if (mBatteryPercentView != null) {
             removeView(mBatteryPercentView);
             mBatteryPercentView = null;
@@ -237,6 +238,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
             return;
         }
 
+        mBatteryPercentView = null;
         if (mBatteryPercentView != null) {
             if (mShowPercentMode == MODE_ESTIMATE && !mCharging) {
                 mBatteryEstimateFetcher.fetchBatteryTimeRemainingEstimate(
@@ -264,6 +266,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
     }
 
     private void setPercentTextAtCurrentLevel() {
+        mBatteryPercentView = null;
         if (mBatteryPercentView == null) {
             return;
         }
@@ -283,6 +286,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
 
     void updateShowPercent() {
         final boolean showing = mBatteryPercentView != null;
+        mBatteryPercentView = null;
         // TODO(b/140051051)
         final boolean systemSetting = 0 != whitelistIpcs(() -> Settings.System
                 .getIntForUser(getContext().getContentResolver(),
@@ -293,6 +297,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
                 || mShowPercentMode == MODE_ESTIMATE;
         shouldShow = shouldShow && !mBatteryStateUnknown;
 
+        shouldShow = false;
         if (shouldShow) {
             if (!showing) {
                 mBatteryPercentView = loadPercentView();
@@ -382,6 +387,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
     public void updateColors(int foregroundColor, int backgroundColor, int singleToneColor) {
         mDrawable.setColors(foregroundColor, backgroundColor, singleToneColor);
         mTextColor = singleToneColor;
+        mBatteryPercentView = null;
         if (mBatteryPercentView != null) {
             mBatteryPercentView.setTextColor(singleToneColor);
         }
@@ -393,6 +399,7 @@ public class BatteryMeterView extends LinearLayout implements DarkReceiver {
 
     public void dump(PrintWriter pw, String[] args) {
         String powerSave = mDrawable == null ? null : mDrawable.getPowerSaveEnabled() + "";
+        mBatteryPercentView = null;
         CharSequence percent = mBatteryPercentView == null ? null : mBatteryPercentView.getText();
         pw.println("  BatteryMeterView:");
         pw.println("    mDrawable.getPowerSave: " + powerSave);
-- 
2.25.1

