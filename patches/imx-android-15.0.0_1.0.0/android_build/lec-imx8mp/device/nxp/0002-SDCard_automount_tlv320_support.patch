From 6e7985b498d87b01dbdaff6cad99568a1dc6bcfc Mon Sep 17 00:00:00 2001
From: veeraadlink <veera.h@adlinktech.com>
Date: Thu, 5 Jun 2025 14:41:10 +0530
Subject: [PATCH] SDCard_automount_tlv320_support

---
 imx8m/lec_imx8mp/SharedBoardConfig.mk | 2 +-
 imx8m/lec_imx8mp/fstab.nxp            | 2 +-
 imx8m/lec_imx8mp/lec_imx8mp.mk        | 1 +
 3 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/imx8m/lec_imx8mp/SharedBoardConfig.mk b/imx8m/lec_imx8mp/SharedBoardConfig.mk
index 091d816b..c28dc4e8 100644
--- a/imx8m/lec_imx8mp/SharedBoardConfig.mk
+++ b/imx8m/lec_imx8mp/SharedBoardConfig.mk
@@ -50,6 +50,7 @@ BOARD_VENDOR_KERNEL_MODULES += \
     $(KERNEL_OUT)/drivers/gpu/drm/bridge/synopsys/dw-hdmi-gp-audio.ko \
     $(KERNEL_OUT)/sound/soc/codecs/snd-soc-hdmi-codec.ko \
     $(KERNEL_OUT)/sound/soc/codecs/snd-soc-wm8960.ko \
+    $(KERNEL_OUT)/sound/soc/fsl/snd-soc-imx-tlv320aic3x.ko \
     $(KERNEL_OUT)/sound/soc/codecs/snd-soc-bt-sco.ko \
     $(KERNEL_OUT)/sound/soc/generic/snd-soc-simple-card-utils.ko \
     $(KERNEL_OUT)/sound/soc/generic/snd-soc-simple-card.ko \
@@ -232,7 +233,6 @@ BOARD_VENDOR_RAMDISK_KERNEL_MODULES +=     \
     $(KERNEL_OUT)/drivers/gpu/drm/panel/panel-simple.ko \
     $(KERNEL_OUT)/drivers/usb/dwc3/dwc3-imx8mp.ko \
     $(KERNEL_OUT)/drivers/usb/typec/mux/gpio-switch.ko \
-    $(KERNEL_OUT)/drivers/power/supply/dummy_battery.ko \
     $(KERNEL_OUT)/drivers/nvmem/nvmem-imx-ocotp.ko \
     $(KERNEL_OUT)/drivers/perf/fsl_imx8_ddr_perf.ko \
     $(KERNEL_OUT)/drivers/cpufreq/cpufreq-dt.ko \
diff --git a/imx8m/lec_imx8mp/fstab.nxp b/imx8m/lec_imx8mp/fstab.nxp
index 7c8ec547..2d7ec992 100644
--- a/imx8m/lec_imx8mp/fstab.nxp
+++ b/imx8m/lec_imx8mp/fstab.nxp
@@ -8,7 +8,7 @@
 /dev/block/by-name/metadata    /metadata    f2fs    noatime,nosuid,nodev,discard,sync,fsync_mode=nobarrier                           wait,formattable,first_stage_mount,check
 /dev/block/by-name/misc        /misc        emmc    defaults                                                                         defaults
 /dev/block/zram0 none swap defaults zramsize=629145600
-
+/devices/platform/soc@0/30800000.bus/30b50000.mmc/mmc_host/* auto auto defaults voldmanaged=sdcard1:auto,encryptable=userdata
 system                         /system       erofs ro                                                              wait,slotselect,avb,avb_keys=/avb,logical,first_stage_mount
 system                         /system       ext4  noatime,errors=panic,ro,barrier=1,inode_readahead_blks=8        wait,slotselect,avb,avb_keys=/avb,logical,first_stage_mount
 system_dlkm                    /system_dlkm  erofs ro                                                              wait,slotselect,avb,logical,first_stage_mount
diff --git a/imx8m/lec_imx8mp/lec_imx8mp.mk b/imx8m/lec_imx8mp/lec_imx8mp.mk
index e0a24cb5..6c26e847 100644
--- a/imx8m/lec_imx8mp/lec_imx8mp.mk
+++ b/imx8m/lec_imx8mp/lec_imx8mp.mk
@@ -271,6 +271,7 @@ $(call inherit-product-if-exists, vendor/nxp-private/widevine/apex/device.mk)
 
 # Audio card json
 PRODUCT_COPY_FILES += \
+    $(CONFIG_REPO_PATH)/common/audio-json/tlv320_config.json:$(TARGET_COPY_OUT_VENDOR)/etc/configs/audio/tlv320_config.json \
     $(CONFIG_REPO_PATH)/common/audio-json/wm8960_config.json:$(TARGET_COPY_OUT_VENDOR)/etc/configs/audio/wm8960_config.json \
     $(CONFIG_REPO_PATH)/common/audio-json/wm8962_config.json:$(TARGET_COPY_OUT_VENDOR)/etc/configs/audio/wm8962_config.json \
     $(CONFIG_REPO_PATH)/common/audio-json/micfil_config.json:$(TARGET_COPY_OUT_VENDOR)/etc/configs/audio/micfil_config.json \
-- 
2.34.1

