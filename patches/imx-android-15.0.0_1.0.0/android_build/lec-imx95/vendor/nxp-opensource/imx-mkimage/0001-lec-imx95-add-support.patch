From bf46f666ac914893f26d9ddff8920bf5444fbc63 Mon Sep 17 00:00:00 2001
From: veeraadlink <veera.h@adlinktech.com>
Date: Wed, 22 Oct 2025 13:32:17 +0530
Subject: [PATCH] lec-imx95-add-support

---
 iMX95/soc.mak       | 14 +++++++++++---
 scripts/fspi_header |  2 +-
 2 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/iMX95/soc.mak b/iMX95/soc.mak
index 92e6110..ec4951a 100644
--- a/iMX95/soc.mak
+++ b/iMX95/soc.mak
@@ -65,12 +65,14 @@ OEI_A55_LOAD_ADDR ?= 0x20498000
 OEI_A55_ENTR_ADDR ?= $(OEI_A55_LOAD_ADDR)
 OEI_M33_LOAD_ADDR ?= 0x1ffc0000
 OEI_M33_ENTR_ADDR ?= 0x1ffc0001	# = real entry address (0x1ffc0000) + 1
+OEI_M33_DAT_LOAD_ADDR ?= 0x4aa80000
 
 OEI_OPT_A55 ?=
 OEI_OPT_M33 ?=
 
 OEI_IMG_A55 ?=
 OEI_IMG_M33 ?=
+OEI_OPT_M33_DATA ?=
 
 lpddr_imem = $(LPDDR_TYPE)_imem$(LPDDR_FW_VERSION).bin
 lpddr_dmem = $(LPDDR_TYPE)_dmem$(LPDDR_FW_VERSION).bin
@@ -82,6 +84,7 @@ OEI_A55_DDR_IMG ?= oei-a55-ddr.bin
 OEI_M33_DDR_IMG ?= oei-m33-ddr.bin
 OEI_A55_TCM_IMG ?= oei-a55-tcm.bin
 OEI_M33_TCM_IMG ?= oei-m33-tcm.bin
+OEI_M33_DAT_IMG ?= oei-m33-dat.bin
 
 A55_OEI_DDRFW = a55-oei-ddrfw.bin
 M33_OEI_DDRFW = m33-oei-ddrfw.bin
@@ -112,6 +115,11 @@ OEI_OPT_M33 += -oei $(OEI_M33_TCM_IMG) m33 $(OEI_M33_ENTR_ADDR) $(OEI_M33_LOAD_A
 OEI_IMG_M33 += $(OEI_M33_TCM_IMG)
 endif
 
+ifneq (,$(wildcard $(OEI_M33_DAT_IMG)))
+OEI_OPT_M33_DATA += -data $(OEI_M33_DAT_IMG) m33 $(OEI_M33_DAT_LOAD_ADDR)
+OEI_IMG_M33 += $(OEI_M33_DAT_IMG)
+endif
+
 ifeq (,$(OEI_IMG_M33))
 $(warning "Note: There are no Cortex-M33 oei images")
 endif
@@ -294,7 +302,7 @@ flash_lpboot_flexspi_xip: $(MKIMG) $(AHAB_IMG) $(MCU_IMG) $(OEI_IMG_M33)
 	./$(QSPI_PACKER) $(QSPI_HEADER)
 
 flash_a55: $(MKIMG) $(AHAB_IMG) $(MCU_IMG) u-boot-atf-container.img $(SPL_A55_IMG) $(OEI_IMG_M33) $(OEI_M33_DDR_IMG)
-	./$(MKIMG) -soc IMX9 -append $(AHAB_IMG) -c $(OEI_OPT_M33) -msel $(MSEL) \
+	./$(MKIMG) -soc IMX9 -append $(AHAB_IMG) -c $(OEI_OPT_M33_DATA) $(OEI_OPT_M33) -msel $(MSEL) \
 		   -m33 $(MCU_IMG) 0 $(MCU_TCM_ADDR) \
 		   -ap $(SPL_A55_IMG) a55 $(SPL_LOAD_ADDR_M33_VIEW) $(V2X_DUMMY) -out flash.bin
 	$(call append_container,u-boot-atf-container.img,1)
@@ -306,7 +314,7 @@ flash_a55_no_ahabfw: $(MKIMG) $(MCU_IMG) u-boot-atf-container.img $(SPL_A55_IMG)
 	$(call append_container,u-boot-atf-container.img,1)
 
 flash_a55_flexspi: $(MKIMG) $(AHAB_IMG) $(MCU_IMG) $(SPL_A55_IMG) $(OEI_IMG_M33) fcb.bin u-boot-atf-container.img
-	./$(MKIMG) -soc IMX9 -dev flexspi -append $(AHAB_IMG) -c $(OEI_OPT_M33) -msel $(MSEL) \
+	./$(MKIMG) -soc IMX9 -dev flexspi -append $(AHAB_IMG) -c $(OEI_OPT_M33_DATA) $(OEI_OPT_M33) -msel $(MSEL) \
 		   -m33 $(MCU_IMG) 0 $(MCU_TCM_ADDR) \
 		   -ap $(SPL_A55_IMG) a55 $(SPL_LOAD_ADDR_M33_VIEW) $(V2X_DUMMY) -fcb fcb.bin $(FCB_LOAD_ADDR) -out flash.bin
 	$(call append_container,u-boot-atf-container.img,1)
@@ -343,7 +351,7 @@ flash_m7_ddr: $(MKIMG) $(MCU_IMG) $(M7_IMG) $(OEI_IMG_M33) $(AHAB_IMG)
 		   -m7 $(M7_IMG) 0 $(M7_DDR_ADDR) $(M7_DDR_ADDR) $(V2X_DUMMY) -out flash.bin
 
 flash_all: $(MKIMG) $(AHAB_IMG) $(MCU_IMG) $(M7_IMG) u-boot-atf-container.img $(SPL_A55_IMG) $(OEI_IMG_M33)
-	./$(MKIMG) -soc IMX9 -append $(AHAB_IMG) -c $(OEI_OPT_M33) -msel $(MSEL) \
+	./$(MKIMG) -soc IMX9 -append $(AHAB_IMG) -c $(OEI_OPT_M33_DATA) $(OEI_OPT_M33) -msel $(MSEL) \
 		   -m33 $(MCU_IMG) 0 $(MCU_TCM_ADDR) \
 		   -m7 $(M7_IMG) 0 $(M7_TCM_ADDR) $(M7_TCM_ADDR_ALIAS)  \
 		   -ap $(SPL_A55_IMG) a55 $(SPL_LOAD_ADDR_M33_VIEW) $(V2X_DUMMY) -out flash.bin
diff --git a/scripts/fspi_header b/scripts/fspi_header
index 07513b5..3b45f43 100644
--- a/scripts/fspi_header
+++ b/scripts/fspi_header
@@ -15,7 +15,7 @@
 00000000
 00000000
 00000000
-01010200 /* Serial Nor, Single/Dual/Quad/Octal, SerialClkFreq 1 - 20MHz, 2- 50MHz... */
+01010100 /* Serial Nor, Single/Dual/Quad/Octal, SerialClkFreq 1 - 20MHz, 2- 50MHz... */
 00000000
 00000000
 00000010 /* SFlashA1Size */
-- 
2.34.1

